<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PyCalendar - Calendrier Sportif</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- STYLES_PLACEHOLDER -->
</head>
<body>
    <div class="app-container">
        <!-- ==================== HEADER ==================== -->
        <header class="header">
            <h1 class="header-title">üìÖ PyCalendar</h1>
            <p class="header-subtitle">Syst√®me de cr√©ation de calendriers sportifs</p>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="totalMatches">0</div>
                    <div class="stat-label">Matchs planifi√©s</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalUnscheduled">0</div>
                    <div class="stat-label">Non planifi√©s</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalWeeks">0</div>
                    <div class="stat-label">Semaines</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalPools">0</div>
                    <div class="stat-label">Poules</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalVenues">0</div>
                    <div class="stat-label">Gymnases</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalAvailableSlots">0</div>
                    <div class="stat-label">Cr√©neaux libres</div>
                </div>
            </div>
        </header>
        
        <!-- ==================== CONTROLS ==================== -->
        <section class="controls-section">
            <!-- Filtres de donn√©es -->
            <div class="control-group">
                <h3 class="control-group-title">
                    <span>üîç Filtres</span>
                    <button class="btn btn-primary btn-reset btn-reset-compact">üîÑ</button>
                    <button class="collapse-btn" id="collapseFilters" title="Replier/D√©plier">
                        <span class="collapse-icon">‚ñº</span>
                    </button>
                </h3>
                <div class="controls-grid collapsible-content" id="filtersContent">
                    <!-- Genre -->
                    <div class="control-item">
                        <label class="control-label">‚ößÔ∏è Genre</label>
                        <div class="gender-filter">
                            <button class="gender-btn active" data-gender="">Tous</button>
                            <button class="gender-btn male" data-gender="M">‚ôÇ Masculin</button>
                            <button class="gender-btn female" data-gender="F">‚ôÄ F√©minin</button>
                        </div>
                    </div>
                    
                    <!-- Semaine -->
                    <div class="control-item">
                        <label class="control-label" for="filterWeek">üìÖ Semaine</label>
                        <select id="filterWeek">
                            <option value="">Toutes les semaines</option>
                        </select>
                    </div>
                    
                    <!-- Gymnase -->
                    <div class="control-item">
                        <label class="control-label" for="filterVenue">üè¢ Gymnase</label>
                        <select id="filterVenue">
                            <option value="">Tous les gymnases</option>
                        </select>
                    </div>
                    
                    <!-- Poule -->
                    <div class="control-item">
                        <label class="control-label" for="filterPool">üéØ Poule</label>
                        <select id="filterPool">
                            <option value="">Toutes les poules</option>
                        </select>
                    </div>
                    
                    <!-- Institution -->
                    <div class="control-item">
                        <label class="control-label" for="filterInstitution">üèõÔ∏è Institution</label>
                        <select id="filterInstitution">
                            <option value="">Toutes les institutions</option>
                        </select>
                    </div>
                    
                    <!-- √âquipe -->
                    <div class="control-item">
                        <label class="control-label" for="filterTeam">üë• √âquipe</label>
                        <select id="filterTeam">
                            <option value="">Toutes les √©quipes</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- S√©parateur -->
            <div class="controls-separator"></div>
            
            <!-- Options d'affichage -->
            <div class="control-group">
                <h3 class="control-group-title">
                    <span>‚öôÔ∏è Affichage</span>
                    <button class="btn btn-primary btn-reset btn-reset-compact" id="btnResetDisplay">üîÑ</button>
                    <button class="collapse-btn" id="collapseOptions" title="Replier/D√©plier">
                        <span class="collapse-icon">‚ñº</span>
                    </button>
                </h3>
                <div class="collapsible-content" id="optionsContent">
                <div class="display-options">
                    <div class="toggle-container" id="togglePreferences" data-visible-tabs="calendar,pools,venues,unscheduled">
                        <div class="toggle-switch"></div>
                        <span class="toggle-label">‚è∞ Horaires pr√©f√©r√©s</span>
                    </div>
                    <div class="toggle-container" id="toggleInstitutions" data-visible-tabs="calendar,pools,venues,unscheduled">
                        <div class="toggle-switch"></div>
                        <span class="toggle-label">üèõÔ∏è Institutions</span>
                    </div>
                    <div class="toggle-container" id="toggleGenreBadges" data-visible-tabs="calendar,pools,venues,unscheduled">
                        <div class="toggle-switch"></div>
                        <span class="toggle-label">‚ößÔ∏è Badges genre</span>
                    </div>
                    <div class="toggle-container" id="toggleAvailableSlots" data-visible-tabs="grid">
                        <div class="toggle-switch"></div>
                        <span class="toggle-label">üìÖ Cr√©neaux libres</span>
                    </div>
                </div>
                
                <!-- Contr√¥les compacts -->
                <div class="compact-controls">
                    <!-- Colonnes pour les vues en liste -->
                    <div class="compact-control" id="zoomCardControl" data-visible-tabs="calendar,pools,venues,unscheduled">
                        <button class="compact-btn" id="zoomCardOut" title="Moins de colonnes">‚àí</button>
                        <span class="compact-value" id="zoomCardValue">3 colonnes</span>
                        <button class="compact-btn" id="zoomCardIn" title="Plus de colonnes">+</button>
                    </div>
                    
                    <!-- Granularit√© pour la vue grille -->
                    <div class="compact-control" id="zoomGridControl" data-visible-tabs="grid">
                        <button class="compact-btn" id="zoomGridOut" title="Moins d√©taill√©">‚àí</button>
                        <span class="compact-value" id="zoomGridValue">60min</span>
                        <button class="compact-btn" id="zoomGridIn" title="Plus d√©taill√©">+</button>
                    </div>
                </div>
                </div>
            </div>
        </section>
        
        <!-- ==================== FILTER INFO ==================== -->
        <div id="filterInfo" class="filter-info"></div>
        
        <!-- ==================== CONTENT ==================== -->
        <main class="content-section">
            <!-- TABS -->
            <nav class="tabs-nav">
                <button class="tab-btn active" data-tab="grid">&#x1F4CA; Calendrier</button>
                <button class="tab-btn" data-tab="calendar">&#x1F4C5; Par semaines</button>
                <button class="tab-btn" data-tab="pools">&#x1F3AF; Par Poule</button>
                <button class="tab-btn" data-tab="venues">&#x1F3E2; Par Gymnase</button>
                <button class="tab-btn" data-tab="penalized">&#x1F4B0; Matchs P√©nalis√©s</button>
                <button class="tab-btn" data-tab="unscheduled" id="unscheduledTab">&#x26A0;&#xFE0F; Non Planifi√©s</button>
            </nav>
            
            <!-- TAB CONTENTS -->
            <div id="gridContent" class="tab-content active"></div>
            <div id="calendarContent" class="tab-content"></div>
            <div id="poolsContent" class="tab-content"></div>
            <div id="venuesContent" class="tab-content"></div>
            <div id="penalizedContent" class="tab-content"></div>
            <div id="unscheduledContent" class="tab-content"></div>
        </main>
    </div>
    
    <!-- SCRIPTS -->
    <!-- SCRIPTS_PLACEHOLDER -->
    
    <script>
        // ==================== DONN√âES ====================
        const matchsData = {{MATCHES_DATA}};
        const unscheduledData = {{UNSCHEDULED_DATA}};
        const availableSlotsData = {{AVAILABLE_SLOTS_DATA}};
        
        // Rendre accessible globalement
        window.matchsData = matchsData;
        window.unscheduledData = unscheduledData;
        window.availableSlotsData = availableSlotsData;
        
        // ==================== INITIALISATION ====================
        class PyCalendarApp {
            constructor() {
                this.filterManager = new FilterManager();
                this.calendarGridView = new CalendarGridView();
                this.currentTab = 'grid';
            }
            
            init() {
                console.log('üöÄ Initialisation PyCalendar Pro V2');
                console.log('  Matchs planifi√©s:', matchsData.length);
                console.log('  Matchs non planifi√©s:', unscheduledData.length);
                console.log('  Cr√©neaux disponibles:', availableSlotsData.length);
                
                const stats = Utils.calculateStats(matchsData);
                
                // Update header stats
                document.getElementById('totalMatches').textContent = stats.totalMatches;
                document.getElementById('totalUnscheduled').textContent = unscheduledData.length;
                document.getElementById('totalWeeks').textContent = stats.totalWeeks;
                document.getElementById('totalPools').textContent = stats.totalPools;
                document.getElementById('totalVenues').textContent = stats.totalVenues;
                document.getElementById('totalAvailableSlots').textContent = availableSlotsData.length;
                
                // Update unscheduled tab
                if (unscheduledData.length > 0) {
                    document.getElementById('unscheduledTab').textContent = `‚ö†Ô∏è Non Planifi√©s (${unscheduledData.length})`;
                }
                
                // Initialize filter manager
                this.filterManager.initializeUI(stats);
                
                // Listen to filter changes
                this.filterManager.onChange((filters, preferences) => {
                    this.render(filters, preferences);
                });
                
                // Setup tabs
                this.setupTabs();
                
                // Update display options visibility for initial tab
                this.filterManager.updateDisplayOptionsVisibility(this.currentTab);
                
                // Initial render
                this.render(this.filterManager.filters, this.filterManager.preferences);
                
                console.log('‚úÖ Initialisation termin√©e');
            }
            
            setupTabs() {
                const tabs = document.querySelectorAll('.tab-btn');
                tabs.forEach(tab => {
                    tab.addEventListener('click', () => {
                        // Remove active
                        tabs.forEach(t => t.classList.remove('active'));
                        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                        
                        // Add active
                        tab.classList.add('active');
                        this.currentTab = tab.dataset.tab;
                        const contentId = tab.dataset.tab + 'Content';
                        document.getElementById(contentId).classList.add('active');
                        
                        // Update display options visibility based on active tab
                        this.filterManager.updateDisplayOptionsVisibility(this.currentTab);
                        
                        // Re-render current tab
                        this.render(this.filterManager.filters, this.filterManager.preferences);
                    });
                });
            }
            
            render(filters, preferences) {
                const filtered = this.filterManager.getFilteredMatches(matchsData);
                const unscheduledFiltered = this.filterManager.getFilteredUnscheduled(unscheduledData);
                
                // Update filter info
                CalendarView.updateFilterInfo(filtered, unscheduledFiltered, filters);
                
                // Render based on current tab
                switch (this.currentTab) {
                    case 'calendar':
                        // Vue calendrier originale (par semaine avec cartes)
                        CalendarView.renderByWeek(filtered, filters, preferences);
                        break;
                    case 'grid':
                        // Nouvelle vue grille type Google Calendar
                        // IMPORTANT: Utiliser matchsData (tous les matchs) et non filtered
                        // Car la vue grille g√®re elle-m√™me le filtrage par semaine
                        const container = document.getElementById('gridContent');
                        console.log('üîÑ Render grid - Tab actif:', this.currentTab);
                        console.log('  Total matchs:', matchsData.length);
                        console.log('  Container:', container);
                        this.calendarGridView.render(container, matchsData, availableSlotsData, filters, preferences);
                        break;
                    case 'pools':
                        CalendarView.renderByPool(filtered, filters, preferences);
                        break;
                    case 'venues':
                        CalendarView.renderByVenue(filtered, filters, preferences);
                        break;
                    case 'penalized':
                        PenaltiesView.render(filtered, filters, preferences);
                        break;
                    case 'unscheduled':
                        CalendarView.renderUnscheduled(unscheduledFiltered, filters, preferences);
                        break;
                }
            }
        }
        
        // ==================== LANCEMENT ====================
        const app = new PyCalendarApp();
        
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => app.init());
        } else {
            app.init();
        }
    </script>
</body>
</html>
