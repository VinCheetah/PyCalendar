<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PyCalendar        <!-- ==================== CONTENT ==================== -->
        <main class="content-section">
            <!-- TABS -->
            <nav class="tabs-nav">
                <button class="tab-btn active" data-tab="grid">&#x1F4CA; Calendrier</button>
                <button class="tab-btn" data-tab="calendar">&#x1F4C5; Par semaines</button>
                <button class="tab-btn" data-tab="pools">&#x1F3AF; Par Poule</button>
                <button class="tab-btn" data-tab="venues">&#x1F3E2; Par Gymnase</button>
                <button class="tab-btn" data-tab="unscheduled" id="unscheduledTab">&#x26A0;&#xFE0F; Non PlanifiÃ©s</button>
            </nav>ier Handball</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- STYLES_PLACEHOLDER -->
</head>
<body>
    <div class="app-container">
        <!-- ==================== HEADER ==================== -->
        <header class="header">
            <h1 class="header-title">ğŸ PyCalendar</h1>
            <p class="header-subtitle">SystÃ¨me de crÃ©ation de calendriers sportifs</p>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="totalMatches">0</div>
                    <div class="stat-label">Matchs planifiÃ©s</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalUnscheduled">0</div>
                    <div class="stat-label">Non planifiÃ©s</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalWeeks">0</div>
                    <div class="stat-label">Semaines</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalPools">0</div>
                    <div class="stat-label">Poules</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalVenues">0</div>
                    <div class="stat-label">Gymnases</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalAvailableSlots">0</div>
                    <div class="stat-label">CrÃ©neaux libres</div>
                </div>
            </div>
        </header>
        
        <!-- ==================== CONTROLS ==================== -->
        <section class="controls-section">
            <!-- Filtres de donnÃ©es -->
            <div class="control-group">
                <h3 class="control-group-title">
                    <span>ğŸ” Filtres</span>
                    <button class="btn btn-primary btn-reset btn-reset-compact">ğŸ”„</button>
                    <button class="collapse-btn" id="collapseFilters" title="Replier/DÃ©plier">
                        <span class="collapse-icon">â–¼</span>
                    </button>
                </h3>
                <div class="controls-grid collapsible-content" id="filtersContent">
                    <!-- Genre -->
                    <div class="control-item">
                        <label class="control-label">âš§ï¸ Genre</label>
                        <div class="gender-filter">
                            <button class="gender-btn active" data-gender="">Tous</button>
                            <button class="gender-btn male" data-gender="M">â™‚ Masculin</button>
                            <button class="gender-btn female" data-gender="F">â™€ FÃ©minin</button>
                        </div>
                    </div>
                    
                    <!-- Semaine -->
                    <div class="control-item">
                        <label class="control-label" for="filterWeek">ğŸ“… Semaine</label>
                        <select id="filterWeek">
                            <option value="">Toutes les semaines</option>
                        </select>
                    </div>
                    
                    <!-- Gymnase -->
                    <div class="control-item">
                        <label class="control-label" for="filterVenue">ğŸ¢ Gymnase</label>
                        <select id="filterVenue">
                            <option value="">Tous les gymnases</option>
                        </select>
                    </div>
                    
                    <!-- Poule -->
                    <div class="control-item">
                        <label class="control-label" for="filterPool">ğŸ¯ Poule</label>
                        <select id="filterPool">
                            <option value="">Toutes les poules</option>
                        </select>
                    </div>
                    
                    <!-- Institution -->
                    <div class="control-item">
                        <label class="control-label" for="filterInstitution">ğŸ›ï¸ Institution</label>
                        <select id="filterInstitution">
                            <option value="">Toutes les institutions</option>
                        </select>
                    </div>
                    
                    <!-- Ã‰quipe -->
                    <div class="control-item">
                        <label class="control-label" for="filterTeam">ğŸ‘¥ Ã‰quipe</label>
                        <select id="filterTeam">
                            <option value="">Toutes les Ã©quipes</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- SÃ©parateur -->
            <div class="controls-separator"></div>
            
            <!-- Options d'affichage -->
            <div class="control-group">
                <h3 class="control-group-title">
                    <span>âš™ï¸ Affichage</span>
                    <button class="btn btn-primary btn-reset btn-reset-compact" id="btnResetDisplay">ğŸ”„</button>
                    <button class="collapse-btn" id="collapseOptions" title="Replier/DÃ©plier">
                        <span class="collapse-icon">â–¼</span>
                    </button>
                </h3>
                <div class="collapsible-content" id="optionsContent">
                <div class="display-options">
                    <div class="toggle-container" id="togglePreferences" data-visible-tabs="calendar,pools,venues,unscheduled">
                        <div class="toggle-switch"></div>
                        <span class="toggle-label">â° Horaires prÃ©fÃ©rÃ©s</span>
                    </div>
                    <div class="toggle-container" id="toggleInstitutions" data-visible-tabs="calendar,pools,venues,unscheduled">
                        <div class="toggle-switch"></div>
                        <span class="toggle-label">ğŸ›ï¸ Institutions</span>
                    </div>
                    <div class="toggle-container" id="toggleGenreBadges" data-visible-tabs="calendar,pools,venues,unscheduled">
                        <div class="toggle-switch"></div>
                        <span class="toggle-label">âš§ï¸ Badges genre</span>
                    </div>
                    <div class="toggle-container" id="toggleAvailableSlots" data-visible-tabs="grid">
                        <div class="toggle-switch"></div>
                        <span class="toggle-label">ğŸ“… CrÃ©neaux libres</span>
                    </div>
                </div>
                
                <!-- ContrÃ´les compacts -->
                <div class="compact-controls">
                    <!-- Colonnes pour les vues en liste -->
                    <div class="compact-control" id="zoomCardControl" data-visible-tabs="calendar,pools,venues,unscheduled">
                        <button class="compact-btn" id="zoomCardOut" title="Moins de colonnes">âˆ’</button>
                        <span class="compact-value" id="zoomCardValue">3 colonnes</span>
                        <button class="compact-btn" id="zoomCardIn" title="Plus de colonnes">+</button>
                    </div>
                    
                    <!-- GranularitÃ© pour la vue grille -->
                    <div class="compact-control" id="zoomGridControl" data-visible-tabs="grid">
                        <button class="compact-btn" id="zoomGridOut" title="Moins dÃ©taillÃ©">âˆ’</button>
                        <span class="compact-value" id="zoomGridValue">60min</span>
                        <button class="compact-btn" id="zoomGridIn" title="Plus dÃ©taillÃ©">+</button>
                    </div>
                </div>
                </div>
            </div>
        </section>
        
        <!-- ==================== FILTER INFO ==================== -->
        <div id="filterInfo" class="filter-info"></div>
        
        <!-- ==================== CONTENT ==================== -->
        <main class="content-section">
            <!-- TABS -->
            <nav class="tabs-nav">
                <button class="tab-btn active" data-tab="grid">ï¿½ Calendrier</button>
                <button class="tab-btn" data-tab="calendar">ï¿½ Par semaines</button>
                <button class="tab-btn" data-tab="pools">ğŸ¯ Par Poule</button>
                <button class="tab-btn" data-tab="venues">ğŸ¢ Par Gymnase</button>
                <button class="tab-btn" data-tab="unscheduled" id="unscheduledTab">âš ï¸ Non PlanifiÃ©s</button>
            </nav>
            
            <!-- TAB CONTENTS -->
            <div id="gridContent" class="tab-content active"></div>
            <div id="calendarContent" class="tab-content"></div>
            <div id="poolsContent" class="tab-content"></div>
            <div id="venuesContent" class="tab-content"></div>
            <div id="unscheduledContent" class="tab-content"></div>
        </main>
    </div>
    
    <!-- SCRIPTS -->
    <!-- SCRIPTS_PLACEHOLDER -->
    
    <script>
        // ==================== DONNÃ‰ES ====================
        const matchsData = {{MATCHES_DATA}};
        const unscheduledData = {{UNSCHEDULED_DATA}};
        const availableSlotsData = {{AVAILABLE_SLOTS_DATA}};
        
        // Rendre accessible globalement
        window.matchsData = matchsData;
        window.unscheduledData = unscheduledData;
        window.availableSlotsData = availableSlotsData;
        
        // ==================== INITIALISATION ====================
        class PyCalendarApp {
            constructor() {
                this.filterManager = new FilterManager();
                this.calendarGridView = new CalendarGridView();
                this.currentTab = 'grid';
            }
            
            init() {
                console.log('ğŸš€ Initialisation PyCalendar Pro V2');
                console.log('  Matchs planifiÃ©s:', matchsData.length);
                console.log('  Matchs non planifiÃ©s:', unscheduledData.length);
                console.log('  CrÃ©neaux disponibles:', availableSlotsData.length);
                
                const stats = Utils.calculateStats(matchsData);
                
                // Update header stats
                document.getElementById('totalMatches').textContent = stats.totalMatches;
                document.getElementById('totalUnscheduled').textContent = unscheduledData.length;
                document.getElementById('totalWeeks').textContent = stats.totalWeeks;
                document.getElementById('totalPools').textContent = stats.totalPools;
                document.getElementById('totalVenues').textContent = stats.totalVenues;
                document.getElementById('totalAvailableSlots').textContent = availableSlotsData.length;
                
                // Update unscheduled tab
                if (unscheduledData.length > 0) {
                    document.getElementById('unscheduledTab').textContent = `âš ï¸ Non PlanifiÃ©s (${unscheduledData.length})`;
                }
                
                // Initialize filter manager
                this.filterManager.initializeUI(stats);
                
                // Listen to filter changes
                this.filterManager.onChange((filters, preferences) => {
                    this.render(filters, preferences);
                });
                
                // Setup tabs
                this.setupTabs();
                
                // Update display options visibility for initial tab
                this.filterManager.updateDisplayOptionsVisibility(this.currentTab);
                
                // Initial render
                this.render(this.filterManager.filters, this.filterManager.preferences);
                
                console.log('âœ… Initialisation terminÃ©e');
            }
            
            setupTabs() {
                const tabs = document.querySelectorAll('.tab-btn');
                tabs.forEach(tab => {
                    tab.addEventListener('click', () => {
                        // Remove active
                        tabs.forEach(t => t.classList.remove('active'));
                        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                        
                        // Add active
                        tab.classList.add('active');
                        this.currentTab = tab.dataset.tab;
                        const contentId = tab.dataset.tab + 'Content';
                        document.getElementById(contentId).classList.add('active');
                        
                        // Update display options visibility based on active tab
                        this.filterManager.updateDisplayOptionsVisibility(this.currentTab);
                        
                        // Re-render current tab
                        this.render(this.filterManager.filters, this.filterManager.preferences);
                    });
                });
            }
            
            render(filters, preferences) {
                const filtered = this.filterManager.getFilteredMatches(matchsData);
                const unscheduledFiltered = this.filterManager.getFilteredUnscheduled(unscheduledData);
                
                // Update filter info
                CalendarView.updateFilterInfo(filtered, unscheduledFiltered, filters);
                
                // Render based on current tab
                switch (this.currentTab) {
                    case 'calendar':
                        // Vue calendrier originale (par semaine avec cartes)
                        CalendarView.renderByWeek(filtered, filters, preferences);
                        break;
                    case 'grid':
                        // Nouvelle vue grille type Google Calendar
                        // IMPORTANT: Utiliser matchsData (tous les matchs) et non filtered
                        // Car la vue grille gÃ¨re elle-mÃªme le filtrage par semaine
                        const container = document.getElementById('gridContent');
                        console.log('ğŸ”„ Render grid - Tab actif:', this.currentTab);
                        console.log('  Total matchs:', matchsData.length);
                        console.log('  Container:', container);
                        this.calendarGridView.render(container, matchsData, availableSlotsData, filters, preferences);
                        break;
                    case 'pools':
                        CalendarView.renderByPool(filtered, filters, preferences);
                        break;
                    case 'venues':
                        CalendarView.renderByVenue(filtered, filters, preferences);
                        break;
                    case 'unscheduled':
                        CalendarView.renderUnscheduled(unscheduledFiltered, filters, preferences);
                        break;
                }
            }
        }
        
        // ==================== LANCEMENT ====================
        const app = new PyCalendarApp();
        
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => app.init());
        } else {
            app.init();
        }
    </script>
</body>
</html>
